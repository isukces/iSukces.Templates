# iSukces.Templates
T4 Templates for C# Projects

This project includes templates commonly used for generating C# code.

## Primitive Obsession Template
This template contains the classes `IntKey` and `GuidKey`, which are used to create wrapper structures for the primitive types `int` and `Guid`.

These structures can be utilized to eliminate _primitive obsession_ by replacing primitive types with those that have specific business significance.


## How to use

1. Download T4 include file [PrimitiveObsession.ttinclude](https://raw.githubusercontent.com/isukces/iSukces.Templates/main/Code/iSukces.Templates/PrimitiveObsession.ttinclude),
2. Prepare your own T4 template file. It should look like this:

```csharp
<#@ template language="C#" #>
<#@ include file="PrimitiveObsession.ttinclude" once="true" #>
<#  
    Config.ImplicitUsings.Add("System");
    Config.Namespace = "iSukces.Templates.Demo";
    Config.IncludeFeatures = Features.All;
    // Config.IgnoreFeatures = Features.NewtonsoftJsonSerializer;
    Config.ConvertFromPrimitive = TypeConversion.Implicit;
    Config.ConvertToPrimitive = TypeConversion.Implicit;

    var infos = new[]
    {
        new IntKey("PrimaryKey")
    };


    PrimitiveObsessionBase.WriteAll(infos, this);
    
#>
```
Note: enter proper include file path to `PrimitiveObsession.ttinclude` file.

3. Run the T4 template. The generated code will look like this:

```csharp
// This file was generated by iSukces.Templates ver 1.24.728.1
// Get latest version from https://raw.githubusercontent.com/isukces/iSukces.Templates/main/Code/iSukces.Templates/PrimitiveObsession.ttinclude

using iSukces.Base;
using Newtonsoft.Json;
using System.Globalization;

namespace iSukces.Templates.Demo;

[JsonConverter(typeof(PrimaryKeyJsonConverter))]
public readonly record struct PrimaryKey(int Value): IComparable<int>, IComparable<PrimaryKey>, IEquatable<int>, IPrimitiveWrapper<int>
{
    public bool Equals(int other) => Value.Equals(other);

    public int CompareTo(PrimaryKey other) => Value.CompareTo(other.Value);

    public int CompareTo(int other) => Value.CompareTo(other);

    public static PrimaryKey Parse(string? text)
    {
        text = text?.Trim();
        if (string.IsNullOrEmpty(text))
            throw new ArgumentException("", nameof(text));
        return new PrimaryKey(int.Parse(text, CultureInfo.InvariantCulture));
    }

    public static PrimaryKey? FromNullable(int? value)
        => value is null ? null : new PrimaryKey(value.Value);

    public static implicit operator PrimaryKey(int value) => new PrimaryKey(value);

    public static implicit operator int(PrimaryKey value) => value.Value;

    public static bool operator >(PrimaryKey left, PrimaryKey right) => left.CompareTo(right) > 0;

    public static bool operator <(PrimaryKey left, PrimaryKey right) => left.CompareTo(right) < 0;

    public static bool operator >=(PrimaryKey left, PrimaryKey right) => left.CompareTo(right) >= 0;

    public static bool operator <=(PrimaryKey left, PrimaryKey right) => left.CompareTo(right) <= 0;

}

public sealed class PrimaryKeyJsonConverter : JsonConverter
{
    public override bool CanConvert(Type objectType) => objectType == typeof(PrimaryKey);

    public override object? ReadJson(JsonReader reader, Type objectType, object? existingValue, JsonSerializer serializer)
    {
        return reader.Value switch
        {
            int intValue => new PrimaryKey(intValue),
            long longValue => new PrimaryKey((int)longValue),
            null when objectType == typeof(PrimaryKey?) => null,
            null => throw new NotImplementedException(),
            _ => throw new NotImplementedException()
        };
    }

    public override void WriteJson(JsonWriter writer, object? value, JsonSerializer serializer)
    {
        if (value is null)
            throw new NullReferenceException("value is null");
        writer.WriteValue(((PrimaryKey)value).Value);
    }

}
```

